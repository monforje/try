### Архитектура MVP-v3 «Balanced News» (4 карточки — 2 × 2)

#### 1. Слой клиента — **React Native App**

| Модуль            | Функция                                      | Хранение              |
| ----------------- | -------------------------------------------- | --------------------- |
| **QuizScreen**    | 6–8 вопросов, вычисляет `(x, y)`             | Async Storage         |
| **FeedScreen**    | FlatList на 4 карточки, Pull-to-Refresh      | RAM                   |
| **ArticleScreen** | Рендер чистого HTML, панель реакций          | RAM                   |
| **Network Layer** | Axios / fetch, retry-логика, дебаунс Refresh | —                     |
| **Analytics**     | Локальный счётчик открытий, времени чтения   | Async Storage (батчи) |

*Ключевая особенность:* всё состояние (bias-вектор, реакции) хранится локально и отправляется на сервер батчами, поэтому приложение живёт даже при нестабильном интернете и не срывает NewsAPI-квоту.

---

#### 2. Слой сервиса — **Backend Gateway (Node + Express)**

| Endpoint    | Что делает                                                                                                                                | Внешние вызовы    | Кэш                 |
| ----------- | ----------------------------------------------------------------------------------------------------------------------------------------- | ----------------- | ------------------- |
| `/feed`     | • принимает `(x, y)`<br>• выбирает 2 friendly + 2 opposing источника<br>• делает **1 запрос** к NewsAPI с 4 id<br>• возвращает 4 карточки | NewsAPI           | Redis 30 мин        |
| `/article`  | • по URL вытягивает исходник (axios)<br>• прогоняет через Mercury / Readability<br>• чистит HTML → отдаёт клиенту                         | Оригинальный сайт | Redis 24 ч          |
| `/reaction` | • пишет `userId, articleId, emoji, ts`                                                                                                    | —                 | PostgreSQL / SQLite |

*Трафик:* в худшем случае одно обновление = 1 хит к NewsAPI; все статьи кешируются — мы остаёмся в бесплатном лимите.

---

#### 3.  Хранение и кэш

| Хранилище               | Что лежит                                        | Почему такое                                         |
| ----------------------- | ------------------------------------------------ | ---------------------------------------------------- |
| **Redis**               | ① JSON-фиды (30 мин) ② Чистый HTML статей (24 ч) | молниеносная отдача, ttl-очистка                     |
| **SQLite / PostgreSQL** | Таблица `reactions` + логирование ошибок         | реакции нужны для аналитики и будущей персонализации |

CSV-файл `sources.json` (200 СМИ с координатами) загружается в память при старте сервиса — отдельная БД не нужна.

---

#### 4.  Интеграции

* **NewsAPI** — единственный внешний API в MVP.
* **Mercury Parser** (или self-host Readability) — библиотека в том же контейнере, поэтому лишних сетевых хитов нет.

---

#### 5.  Деплой и окружение

| Уровень        | Вариант по-умолчанию                 | Масштабирование                     |
| -------------- | ------------------------------------ | ----------------------------------- |
| **Backend**    | Docker-контейнер на Fly.io free tier | → Fly.io / Heroku Hobby → GKE / ECS |
| **Redis**      | встроенный TinyRedis (Fly Volumes)   | → Managed Redis (Upstash / AWS)     |
| **PostgreSQL** | Supabase / Render free               | → Managed PG                        |

CI/CD — GitHub Actions → автодеплой в Fly + OTA-сборки Expo Go для RN.

---

#### 6.  Безопасность и регуляторика

* Нет PII: только bias-вектор и анонимный device-ID → GDPR friendly.
* Все внешние вызовы через сервер — ключ NewsAPI не попадает в мобильный билд.
* CORS закрыт, HTTPS по-умолчанию (Fly / Heroku).

---

#### 7.  Эволюционный путь

1. **Переход на платный NewsAPI** или собственный скрейпер → просто меняем провайдер внутри `/feed`.
2. **Больше карточек** — увеличиваем константу, TTL кэша остаётся прежним.
3. **LLM-резюме** — отдельный microservice; клиент уже готов принимать «summary».
4. **Монетизация** — сервер отдаёт рекламу как отдельный объект в массиве карточек.

---

### Что важно запомнить

* **1 обновление = 1 внешний запрос** — экономим квоту и держим скорость.
* Статья **внутри** приложения → полный контроль UX и аналитики.
* Вся масштабируемость «заложена в швы»: заменяем NewsAPI, расширяем базу СМИ, добавляем ML — а пользовательский флоу и сетевой контракт остаются неизменными.